#include <stdio.h>
#include <windows.h>

HANDLE hProcess;
DWORD PID;
HANDLE hThread;
void* mem;
DWORD TID;
HANDLE hKernel32;
char dllPath[MAX_PATH];
int main(int argc,char* argv[]){
    if(argc < 3){
        printf("Usage: %s <PID> <DLL_PATH>\n",argv[0]);
        return 1;
    }
    strcat(dllPath,argv[2]);
    PID = atoi(argv[1]);
    hProcess = OpenProcess(PROCESS_ALL_ACCESS,FALSE,PID);
    mem = VirtualAllocEx(hProcess,NULL,sizeof(dllPath),MEM_COMMIT | MEM_RESERVE,PAGE_READWRITE);
    hKernel32 = GetModuleHandle("Kernel32");
    WriteProcessMemory(hProcess,mem,dllPath,sizeof(dllPath),NULL);
    hThread = CreateRemoteThread(hProcess,NULL,0,(LPTHREAD_START_ROUTINE)GetProcAddress(hKernel32,"LoadLibraryA"),mem,0,&TID);
    WaitForSingleObject(hThread,INFINITE);
    CloseHandle(hThread);
    CloseHandle(hProcess);
    return 0;
}
